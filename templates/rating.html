{% extends "base.html" %}
{% block title %}–†–µ–π—Ç–∏–Ω–≥{% endblock %}

{% block content %}
<h3>–†–µ–π—Ç–∏–Ω–≥ —É—á–µ–Ω–∏–∫–æ–≤</h3>

{% if rating|length == 0 %}
    <p>–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–µ—à–∏–ª üôÇ</p>
{% else %}

    <!-- –¢–∞–±–ª–∏—á–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
    <table class="table table-striped mt-3" style="max-width:600px;">
        <thead>
            <tr>
                <th>#</th>
                <th>–ò–º—è</th>
                <th>–†–µ—à–µ–Ω–æ –∑–∞–¥–∞—á</th>
            </tr>
        </thead>
        <tbody>
            {% for row in rating %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ row.username }}</td>
                <td>{{ row.solved }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- –ë–ª–æ–∫ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º -->
    <div class="mt-4" style="max-width:800px;">
        <h5>–ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</h5>
        <canvas id="ratingChart" height="120"></canvas>
    </div>

{% endif %}

{% endblock %}

{% block extra_scripts %}
    {{ super() }}
    {% if rating|length > 0 %}
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // –î–∞–Ω–Ω—ã–µ –∏–∑ Python -> JS
        const labels = [
            {% for row in rating %}
                "{{ row.username }}"{% if not loop.last %}, {% endif %}
            {% endfor %}
        ];

        const solvedData = [
            {% for row in rating %}
                {{ row.solved }}{% if not loop.last %}, {% endif %}
            {% endfor %}
        ];

        const ctx = document.getElementById('ratingChart').getContext('2d');

        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: '–†–µ—à–µ–Ω–æ –∑–∞–¥–∞—á',
                    data: solvedData,
                    borderWidth: 1
                }]
            },
            options: {
                animation: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
    </script>
    {% endif %}
{% endblock %}
